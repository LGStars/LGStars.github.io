<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  ﻿<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta name="theme-color" content="#222">




<script>
    (function(){
        if(''){
            if (prompt('请输入文章密码') !== ''){
                alert('密码错误！');
                history.back();
            }
        }
    })();
</script>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="时间就像海绵里的水，只要愿挤，总还是有的。">
<meta property="og:type" content="website">
<meta property="og:title" content="LgStars">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="LgStars">
<meta property="og:description" content="时间就像海绵里的水，只要愿挤，总还是有的。">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="LgStars">
<meta name="twitter:description" content="时间就像海绵里的水，只要愿挤，总还是有的。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'JunBoXu'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>LgStars</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?1e0b9fbc3415438997c409b6b7c26a65";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
		

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">LgStars</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">恰同学少年，风华正茂。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/30/16_Android_HTTP协议/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JunBoXu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LgStars">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/30/16_Android_HTTP协议/" itemprop="url">HTTP协议</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-30T13:29:00+08:00">
                2018-04-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/04/30/16_Android_HTTP协议/" class="leancloud_visitors" data-flag-title="HTTP协议">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
				 <span>°C</span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="HTTP简介"><a href="#HTTP简介" class="headerlink" title="HTTP简介"></a>HTTP简介</h2><p>HTTP 协议（HyperText Transfer Protocol，超文本传输协议）是用于从 WWW 服务器传输超文本到本地浏览器的传送协议。它可以使浏览器更加高效，使网络传输减少。它不仅保证计算机正确快速地传输超文本文档，还确定传输文档中的哪一部分，以及哪部分内容首先显示(如文本先于图形)等。</p>
<h3 id="计算机相互之间的通信"><a href="#计算机相互之间的通信" class="headerlink" title="计算机相互之间的通信"></a>计算机相互之间的通信</h3><blockquote>
<p>互联网的关键技术就是 TCP/IP 协议。两台计算机之间的通信是通过<br>TCP/IP 协议在因特网上进行的。实际上这个是两个协议：</p>
</blockquote>
<pre><code>TCP : Transmission Control Protocol 传输控制协议

IP： Internet Protocol 网际协议。
</code></pre><p>TCP 负责应用软件（比如你的浏览器）和网络软件之间的通信。 IP 负责计算机之间的通信。</p>
<pre><code>TCP 负责将数据分割并装入 IP 包， IP 负责将包发送至接受者，传输过程要经 IP 路由器负责根据通信量、网络中的错误或者其他参数来进行正确地寻址，然后在它们到达的时候重新
组合它们。
</code></pre><h3 id="HTTP协议所在的协议层"><a href="#HTTP协议所在的协议层" class="headerlink" title="HTTP协议所在的协议层"></a>HTTP协议所在的协议层</h3><p><img src="https://i.imgur.com/NBdEoIG.png" alt=""></p>
<h3 id="HTTP请求响应模型"><a href="#HTTP请求响应模型" class="headerlink" title="HTTP请求响应模型"></a>HTTP请求响应模型</h3><blockquote>
<p>HTTP 由请求和响应构成，是一个标准的客户端服务器模型（B/S）。<br>HTTP 协议永远都是客户端发起请求，服务器回送响应</p>
</blockquote>
<p><img src="https://i.imgur.com/rtcvTwk.png" alt=""></p>
<blockquote>
<p>HTTP 是一个无状态的协议。无状态是指客户机（Web 浏览器）和服务器&gt; 之间不需要建立持久的连接</p>
</blockquote>
<h3 id="HTTP工作过程"><a href="#HTTP工作过程" class="headerlink" title="HTTP工作过程"></a>HTTP工作过程</h3><pre><code>1 ) 地址解析
2）封装 HTTP 请求数据包
3）封装成 TCP 包，建立 TCP 连接（TCP 的三次握手）
4）客户机发送请求命令
5）服务器响应
6）服务器关闭 TCP 连接

注：一般情况下，一旦 Web 服务器向浏览器发送了请求数据，它就要关闭 TCP 连接，然后如果浏览器或者服务器在其头信息加入了这行代码
    Connection:keep-alive
TCP连接在发送后将仍然保持打开状态，于是，浏览器可以继续通过相同的连接发送请求。保持连接节省了为每个请求建立新连接所需的时间，还节约了网络带宽。
</code></pre><h3 id="HTTP1-0和HTTP1-1的区别"><a href="#HTTP1-0和HTTP1-1的区别" class="headerlink" title="HTTP1.0和HTTP1.1的区别"></a>HTTP1.0和HTTP1.1的区别</h3><blockquote>
<p>在 HTTP1.0 版本中，浏览器请求一个带有图片的网页，会由于下载图片&gt; 而与服务器之间开启一个新的连接；但在 HTTP1.1 版本中，允许浏览器&gt; 在拿到当前请求对应的全部资源后再断开连接，提高了效率。</p>
</blockquote>
<p><img src="https://i.imgur.com/BrYZ9hf.png" alt=""></p>
<h3 id="HTTP请求方式"><a href="#HTTP请求方式" class="headerlink" title="HTTP请求方式"></a>HTTP请求方式</h3><p>HTTP1.1 支持 7 种请求方法： GET、 POST、 HEAD、 OPTIONS、 PUT、 DELETE 和 TARCE</p>
<p><img src="https://i.imgur.com/K28R443.png" alt=""></p>
<h3 id="get请求"><a href="#get请求" class="headerlink" title="get请求"></a>get请求</h3><ul>
<li><p>GET 方法是默认的 HTTP 请求方法，输入网址的方式去访问网页的时候，浏览器采用的就是 GET 方法向服务器获取资源。</p>
</li>
<li><p>我们可以使用 GET 方法来提交表单数据，用 GET 方法提交的表单数据只经过了简单的编码，同时它将作为 URL 的一部分向服务器发送，因此，如果使用 GET 方法来提交表单数据就存在着安全隐患上。例如：</p>
<p>  Http://localhost/login.php?username=aa&amp;password=1234</p>
</li>
<li><p>从上面的 URL 请求中，很容易就可以辩认出表单提交的内容。（？之后的内容）</p>
</li>
<li><p>由于 GET 方法提交的数据是作为 URL 请求的一部分所以提交的数据量不能太大。这是因为浏览器对 url 的长度有限制各种浏览器也会对 url 的长度有所限制</p>
</li>
</ul>
<p><img src="https://i.imgur.com/tTTVGxz.png" alt=""></p>
<h3 id="POST请求"><a href="#POST请求" class="headerlink" title="POST请求"></a>POST请求</h3><blockquote>
<p>下面这是我要填写的一个表，我要把数据传给服务器用的就是 post</p>
</blockquote>
<p><img src="https://i.imgur.com/mO7rE9N.png" alt=""></p>
<p>当我们点击保存的时候</p>
<p><img src="https://i.imgur.com/Tg4sXc7.png" alt=""></p>
<h3 id="请求头"><a href="#请求头" class="headerlink" title="请求头"></a>请求头</h3><p>1、Host : 服务器地址</p>
<p>2、User-Agent — 用户代理 它是一个特殊字符串头，包含了浏览器类型以及版 本以及操作系统，浏览器内核，等信息的标识，通过这些信息可以提供更好的体验或者进行信息统计</p>
<p>3、Accept — 接收的类型<br>    audio/<em> 接受所有的声音文件。<br>    video/</em> 接受所有的视频文件。<br>    image/* 接受所有的图像文件。<br>    IME_type一个有效的 MIME 类型，不带参数。请参阅 IANAMIME 类型，获得标准 MIME 类型的完整列表。</p>
<p>4、Accept-Language — 用于告诉服务器浏览器可以支持什么语言。 如果网站支持多语种的话，可以使用这个信息来决定返回什么语言的网页</p>
<p>5、Accept - Encoding : 是浏览器发给服务器,声明浏览器支持的编码类型常见的有 compress, gzip //支持 compress 和 gzip 类型(压缩)</p>
<p>6、Cookie : 主要用来保存账号和密码</p>
<p>7、Connection : 表示是否需要持久连接</p>
<p>8、Content-Type：告诉浏览器自己响应的对象的类型和字符集, text/html; charset=utf-8 / ContentType: image/jpeg</p>
<h3 id="响应头"><a href="#响应头" class="headerlink" title="响应头"></a>响应头</h3><p>1、Cache-Control 告诉所有的缓存机制是否可以缓存及哪种类型Cache-Control: nocache</p>
<p>2、Content-Type — content-type 是必须的 multipart/form-data 是设置表单的 MIME 编码。默认情况，这个编码格式是application/x-www-form-urlencoded，不能用于文件上传；只有使用了multipart/form-data，才能完整的传递文件数据.</p>
<p>3、Content-Length — 这里的 3693 是要上传文件的总长度</p>
<p>4、Date - 原始服务器消息发出的时间 Date: Tue, 15 Nov 2010 08:12:31 GMT</p>
<p>5、Expires 响应过期的日期和时间 Expires: Thu, 01 Dec 2010 16:00:00 GMT</p>
<p>6、Server web 服务器软件名称</p>
<p>7、Transfer-Encoding 文件传输编码 Transfer-Encoding:chunked</p>
<p>8、Vary 告诉下游代理是使用缓存响应还是从原始服务器请求</p>
<p>9、Accept-Ranges 表明服务器是否支持指定范围请求及哪种类型的分段请求 bytes(断点下载的时候用得到)</p>
<h3 id="响应状态码"><a href="#响应状态码" class="headerlink" title="响应状态码"></a>响应状态码</h3><p>1、200 成功 服务器已成功处理了请求。通常，这表示服务器提供了请求的网页</p>
<p>2、302 重定向 代表让浏览器重新请求另一个资源</p>
<p>3、404 找不到 找不到请求的资源，但有时请求路径正确也返回 404 往往是由于 Web 应用有配置方面的问题， 例如按照配置文件中指定的组件的全类名找不到指定的类。</p>
<p>4、500 错误 服务器内部错误，例如服务器端程序运行时抛出异常。</p>
<pre><code>●响应状态码以 2 开头的通常表示成功。
●响应状态码以 3 开头的通常表示转移。
●响应状态码以 4 开头的通常表示无法访问，其中包括找不到资源或没有权限等。
●响应状态码以 5 开头的通常表示服务器端程序运行出错。
</code></pre>
          
        
      
    </div>
    
    
    
	
	<div>
		
	</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/05/15_Protues_光电耦合/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JunBoXu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LgStars">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/05/15_Protues_光电耦合/" itemprop="url">实现线性传输的非线性光电耦合电路的设计与仿真</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-05T19:49:00+08:00">
                2018-04-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Protues/" itemprop="url" rel="index">
                    <span itemprop="name">Protues</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/04/05/15_Protues_光电耦合/" class="leancloud_visitors" data-flag-title="实现线性传输的非线性光电耦合电路的设计与仿真">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
				 <span>°C</span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h6 id="博客录语-—-拥有梦想只是一种智力，实现梦想才是一种潜力。"><a href="#博客录语-—-拥有梦想只是一种智力，实现梦想才是一种潜力。" class="headerlink" title="博客录语  —  拥有梦想只是一种智力，实现梦想才是一种潜力。"></a>博客录语  —  拥有梦想只是一种智力，实现梦想才是一种潜力。</h6><h2 id="实现线性传输的非线性光电耦合电路的设计与仿真"><a href="#实现线性传输的非线性光电耦合电路的设计与仿真" class="headerlink" title="实现线性传输的非线性光电耦合电路的设计与仿真"></a>实现线性传输的非线性光电耦合电路的设计与仿真</h2><h3 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h3><pre><code>1.1 光电耦合器件把发光器件和光敏器件组装在一起，以光为媒介，实现输入和输出之间的电气隔离。光电耦合是一种简单有效的隔离技术，关键技术在于破坏了“地”干扰的传播途径，切断了干扰信号进入后续电路的途径，有效地抑制了尖脉冲和各种噪声干扰。电流传输比是光电耦合器件性能的一个重要标志，定义为输出电流与输入电流的比值。

1.2 虽然光电耦合器具有非常好的隔离性能，但是由于非线性使其不能在模拟信号的隔离上大量使用。线性光耦的出现有效地解决了这个问题。但用其搭成电路后，电路线性输出范围较窄（在0～3 V左右），并且价格较高，在某种程度上影响了它的适用范围。

1.3 本文利用双路光耦设计了非线性光耦的隔离电路，在实现线性传输完成信号采集的同时，增宽了电路的线性输出范围。
</code></pre><h3 id="2、电路设计"><a href="#2、电路设计" class="headerlink" title="2、电路设计"></a>2、电路设计</h3><h4 id="2-1-设计原理"><a href="#2-1-设计原理" class="headerlink" title="2.1 设计原理"></a>2.1 设计原理</h4><pre><code>2.1.1 线性光耦内部大多采用光敏二极管进行光耦合，因此，线性光耦(如SLC800等)大多都有两种工作模式。光敏三极管虽然是光伏效应器件，但在零偏时，光敏三极管并无信号电流输出。因此，利用光敏三极管进行光耦合的光耦器件仅具有光电导型工作模式。

2.1.2 光敏三极管是一种相当于将基极、集电极光敏二极管的电流加以放大的普通晶体管放大器。其工作过程可分为光电转换和光电流放大两个环节，如右图（1）。当基极受光时，入射光子在基区及收集区被吸收而产生电子-空穴对，生成光生电压，由此产生的光生电流进入发射极，从而在集电极回路中得到了一个放大了β倍的信号电流，如右图（2）。
</code></pre><p><img src="https://i.imgur.com/ldlOhaG.png" alt="设计原理"></p>
<pre><code>2.1.3 由此可知，在同样光照、同样偏压条件下，光敏三极管的输出电流是光敏二极管的β倍，所以光敏三极管构成的光耦电流传输比是光敏二极管的β倍，电路中与光耦串联的同一阻值电阻的分压也是β倍。由此可通过利用光敏三极管进行光耦合的光耦器件设计一种线性输出范围较宽的线性光耦隔离电路。
</code></pre><h4 id="2-2-电路组成"><a href="#2-2-电路组成" class="headerlink" title="2.2 电路组成"></a>2.2 电路组成</h4><pre><code>2.2.1 设计电路由光电耦合部分、输入部分和输出部分组成，如图所示。
双路光耦采用PC817，由两个发光二极管和两个光敏三极管构成。将两发光二极管串联使其通过相同的电流，进而使两光敏三极管受光相同。一光敏三极管构成伺服反馈回路，经运算放大器反馈到输入端，称为伺服光电管；另一光敏三极管构成输出回路，典型用法是后接运算放大器，称为传输光电管。伺服反馈有利于发光二极管输出线性化，主要是利用运算放大器的功能特性，微调发光二极管的传输电流作保证。

2.2.2 电容C的选用是必要的，在电路的工作过程中它主要起反馈作用，若不加电容在输出端会出现三角波，使运放两输入端的电压不能保持一致，影响电路的精度。为增大电路的输入阻抗并减小输出阻抗，在电路的输出端将运放A2作为放大器使用，以提高电路的带负载能力。
</code></pre><p><img src="https://i.imgur.com/adeIiES.png" alt="电路组成"> </p>
<h3 id="3、附录"><a href="#3、附录" class="headerlink" title="3、附录"></a>3、附录</h3><pre><code>3.1 仿真图
</code></pre><p><img src="https://i.imgur.com/Mht62Ez.png" alt="仿真图"></p>
<pre><code>3.2 效果图
</code></pre><p><img src="https://i.imgur.com/aBavLRH.png" alt="效果图"></p>

          
        
      
    </div>
    
    
    
	
	<div>
		
	</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/04/14_Android_点对点传输/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JunBoXu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LgStars">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/04/14_Android_点对点传输/" itemprop="url">点对点传输，Android无网络传输</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-04T14:25:00+08:00">
                2018-04-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/04/04/14_Android_点对点传输/" class="leancloud_visitors" data-flag-title="点对点传输，Android无网络传输">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
				 <span>°C</span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h6 id="博客录语-—-如果要挖井，就要挖到水出为止。"><a href="#博客录语-—-如果要挖井，就要挖到水出为止。" class="headerlink" title="博客录语  —  如果要挖井，就要挖到水出为止。"></a>博客录语  —  如果要挖井，就要挖到水出为止。</h6><h2 id="Android无网络传输原理"><a href="#Android无网络传输原理" class="headerlink" title="Android无网络传输原理"></a>Android无网络传输原理</h2><blockquote>
<p>Wifi P2P是在Android 4.0以及更高版本系统中加入的功能，通过Wifi<br>P2P可以在不连接网络的情况下，直接与配对的设备进行数据交换。相对<br>于蓝牙，Wifi P2P的搜索速度和传输速度更快，传输距离更远.</p>
</blockquote>
<blockquote>
<p>效果图（1）：<img src="https://i.imgur.com/0F2USyX.jpg" alt=""><br>效果图（2）：<img src="https://i.imgur.com/26C533K.jpg" alt=""></p>
</blockquote>
<h3 id="1、步骤说明"><a href="#1、步骤说明" class="headerlink" title="1、步骤说明"></a>1、步骤说明</h3><pre><code>1.1 一般而言，开发步骤分为以下几点：

    （1）在AndroidManifest中声明相关权限（网络和文件读写权限）。

    （2）获取WifiP2pManager，注册相关广播监听Wifi直连的状态变化。

    （3）指定某一台设备为服务器（用来接收文件），创建群组并作为群主存在，在指定端口监听客户端的连接请求，等待客户端发起连接请求以及文件传输请求。

    （4）客户端（用来发送文件）主动搜索附近的设备，加入到服务器创建的群组，获取服务器的IP地址，向其发起文件传输请求。

    （5）校验文件完整性。
</code></pre><h3 id="2、声明权限"><a href="#2、声明权限" class="headerlink" title="2、声明权限"></a>2、声明权限</h3><blockquote>
<p>Wifi P2P技术并不访问网络，但由于会使用到Java套接字，所以需要申<br>请网络权限。此外，由于是要实现文件互传，所以也需要申请SD卡读写权<br>限。</p>
</blockquote>
<pre><code>(1) &lt;uses-permission android:name=&quot;android.permission.ACCESS_WIFI_STATE&quot; /&gt;

（2）&lt;uses-permission android:name=&quot;android.permission.CHANGE_WIFI_STATE&quot; /&gt;

（3）&lt;uses-permission android:name=&quot;android.permission.CHANGE_NETWORK_STATE&quot; /&gt;

（4）&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;

（5）&lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot; /&gt;

（6）&lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; /&gt;

（7）&lt;uses-permission android:name=&quot;android.permission.READ_EXTERNAL_STORAGE&quot; /&gt;
</code></pre><h3 id="3、注册广播"><a href="#3、注册广播" class="headerlink" title="3、注册广播"></a>3、注册广播</h3><pre><code>3.1 与Wifi P2P相关的广播有以下几个：

    （1）WIFI_P2P_STATE_CHANGED_ACTION（用于指示Wifi P2P是否可用）

    （2）WIFI_P2P_PEERS_CHANGED_ACTION（对等节点列表发生了变化）

    （3）WIFI_P2P_CONNECTION_CHANGED_ACTION（Wifi P2P的连接状态发生了改变）

    （4）WIFI_P2P_THIS_DEVICE_CHANGED_ACTION（本设备的设备信息发生了变化）

3.2 当接收到这几个广播时，我们都需要到WifiP2pManager（对等网络管理器）来进行相应的信息请求，此外还需要用到Channel对象作为请求参数

    `mWifiP2pManager = (WifiP2pManager) getSystemService(Context.WIFI_P2P_SERVICE);
    mChannel = mWifiP2pManager.initialize(this, getMainLooper(), this);`

3.3 当收到WifiP2pManager.WIFI_P2P_STATE_CHANGED_ACTION广播时，可以判断当前Wifi P2P是否可用

    `int state = intent.getIntExtra(WifiP2pManager.EXTRA_WIFI_STATE, -1);
    if (state == WifiP2pManager.WIFI_P2P_STATE_ENABLED) {
        mDirectActionListener.wifiP2pEnabled(true);
    } else {
        mDirectActionListener.wifiP2pEnabled(false);                
    }`

3.4 当收到WifiP2pManager.WIFI_P2P_PEERS_CHANGED_ACTION广播时，意味设备周围的可用设备列表发生了变化，可以通过requestPeers方法得到可用的设备列表，之后就可以选择当中的某一个设备进行连接操作

    `mWifiP2pManager.requestPeers(mChannel, new WifiP2pManager.PeerListListener() {
        @Override
        public void onPeersAvailable(WifiP2pDeviceList peers) {
            mDirectActionListener.onPeersAvailable(peers.getDeviceList());
        }
    });`

3.5 当收到WifiP2pManager.WIFI_P2P_CONNECTION_CHANGED_ACTION广播时，意味着Wifi P2P的连接状态发生了变化，可能是连接到了某设备，或者是与某设备断开了连接

    `NetworkInfo networkInfo = intent.getParcelableExtra(WifiP2pManager.EXTRA_NETWORK_INFO);
    if (networkInfo.isConnected()) {
        mWifiP2pManager.requestConnectionInfo(mChannel, new WifiP2pManager.ConnectionInfoListener() {
            @Override
            public void onConnectionInfoAvailable(WifiP2pInfo info) {
                mDirectActionListener.onConnectionInfoAvai          lable(info);
            }
        });
        Log.e(TAG, &quot;已连接p2p设备&quot;);
    } else {
        mDirectActionListener.onDisconnection();
        Log.e(TAG, &quot;与p2p设备已断开连接&quot;);
    }`

3.6 如果是与某设备连接上了，则可以通requestConnectionInfo方法获取到连接信息。当收WifiP2pManager.WIFI_P2P_THIS_DEVICE_CHANGED_ACTION广播时，则可以获取到本设备变化后的设备信息

    `(WifiP2pDevice) intent.getParcelableExtra(WifiP2pManager.EXTRA_WIFI_P2P_DEVICE)`

3.7 可以看出Wifi P2P的接口高度异步化，到现在已经用到了三个系统的回调函数，一个用于WifiP2pManager的初始化，两个用于在广播中异步请求数据，为了简化操作，此处统一使用一个自定义的回调函数，方法含义与系统的回调函数一致

    `public interface DirectActionListener extends WifiP2pManager.ChannelListener {

    void wifiP2pEnabled(boolean enabled);

    void onConnectionInfoAvailable(WifiP2pInfo wifiP2pInfo);

    void onDisconnection();

    void onSelfDeviceAvailable(WifiP2pDevice wifiP2pDevice);

    void onPeersAvailable(Collection&lt;WifiP2pDevice&gt; wifiP2pDeviceList);

    }`

所以，整个广播接收器使用到的所有代码是：

    `public class DirectBroadcastReceiver extends BroadcastReceiver {

    private static final String TAG = &quot;DirectBroadcastReceiver&quot;;

    private WifiP2pManager mWifiP2pManager;

    private WifiP2pManager.Channel mChannel;

    private DirectActionListener mDirectActionListener;

    public DirectBroadcastReceiver(WifiP2pManager wifiP2pManager, WifiP2pManager.Channel channel, DirectActionListener directActionListener) {
        mWifiP2pManager = wifiP2pManager;
        mChannel = channel;
        mDirectActionListener = directActionListener;
    }

    public static IntentFilter getIntentFilter() {
        IntentFilter intentFilter = new IntentFilter();
        intentFilter.addAction(WifiP2pManager.WIFI_P2P_STATE_CHANGED_ACTION);
        intentFilter.addAction(WifiP2pManager.WIFI_P2P_PEERS_CHANGED_ACTION);
        intentFilter.addAction(WifiP2pManager.WIFI_P2P_CONNECTION_CHANGED_ACTION);
        intentFilter.addAction(WifiP2pManager.WIFI_P2P_THIS_DEVICE_CHANGED_ACTION);
        return intentFilter;
    }

    @Override
    public void onReceive(Context context, Intent intent) {
        Log.e(TAG, &quot;接收到广播： &quot; + intent.getAction());
        if (!TextUtils.isEmpty(intent.getAction())) {
            switch (intent.getAction()) {
                // 用于指示 Wifi P2P 是否可用
                case WifiP2pManager.WIFI_P2P_STATE_CHANGED_ACTION: {
                    int state = intent.getIntExtra(WifiP2pManager.EXTRA_WIFI_STATE, -1);
                    if (state == WifiP2pManager.WIFI_P2P_STATE_ENABLED) {
                        mDirectActionListener.wifiP2pEnabled(true);
                    } else {
                        mDirectActionListener.wifiP2pEnabled(false);
                        List&lt;WifiP2pDevice&gt; wifiP2pDeviceList = new ArrayList&lt;&gt;();
                        mDirectActionListener.onPeersAvailable(wifiP2pDeviceList);
                    }
                    break;
                }
                // 对等节点列表发生了变化
                case WifiP2pManager.WIFI_P2P_PEERS_CHANGED_ACTION: {
                    mWifiP2pManager.requestPeers(mChannel, new WifiP2pManager.PeerListListener() {
                        @Override
                        public void onPeersAvailable(WifiP2pDeviceList peers) {
                            mDirectActionListener.onPeersAvailable(peers.getDeviceList());
                        }
                    });
                    break;
                }
                // Wifi P2P 的连接状态发生了改变
                case WifiP2pManager.WIFI_P2P_CONNECTION_CHANGED_ACTION: {
                    NetworkInfo networkInfo = intent.getParcelableExtra(WifiP2pManager.EXTRA_NETWORK_INFO);
                    if (networkInfo.isConnected()) {
                        mWifiP2pManager.requestConnectionInfo(mChannel, new WifiP2pManager.ConnectionInfoListener() {
                            @Override
                            public void onConnectionInfoAvailable(WifiP2pInfo info) {
                                mDirectActionListener.onConnectionInfoAvailable(info);
                            }
                        });
                        Log.e(TAG, &quot;已连接p2p设备&quot;);
                    } else {
                        mDirectActionListener.onDisconnection();
                        Log.e(TAG, &quot;与p2p设备已断开连接&quot;);
                    }
                    break;
                }
                //本设备的设备信息发生了变化
                case WifiP2pManager.WIFI_P2P_THIS_DEVICE_CHANGED_ACTION: {
                    mDirectActionListener.onSelfDeviceAvailable((WifiP2pDevice) intent.getParcelableExtra(WifiP2pManager.EXTRA_WIFI_P2P_DEVICE));
                    break;
                }
            }
        }
    }

}`
</code></pre><h3 id="4、服务器端创建群组"><a href="#4、服务器端创建群组" class="headerlink" title="4、服务器端创建群组"></a>4、服务器端创建群组</h3><pre><code>4.1 假设当设备甲搜索到了设备B，并与设备乙连接到了一起，此时系统会自动创建一个群组（集团）并随机指定一台设备为群主（GroupOwner）。此时，对于两台设备来说，群主的IP地址是可知的（系统回调函数中有提供），但客户端的IP地址需要再来通过其他方法来主动获取。例如，可以在设备连接成功后，客户端主动发起对服务器端的插座连接请求，服务器端在指定端口监听客户端的连接请求，当连接成功后，服务器端就可以获取到客户端的IP地址了。此处为了简化操作，直接指定某台设备作为服务器端（群主），即直接指定某台设备用来接收文件。因此，服务器端要主动创建群组，并等待客户端的连接。

`wifiP2pManager.createGroup(channel, new WifiP2pManager.ActionListener() {
    @Override
    public void onSuccess() {
        Log.e(TAG, &quot;createGroup onSuccess&quot;);
        dismissLoadingDialog();
        showToast(&quot;onSuccess&quot;);
    }

     @Override
     public void onFailure(int reason) {
        Log.e(TAG, &quot;createGroup onFailure: &quot; + reason);
        dismissLoadingDialog();
        showToast(&quot;onFailure&quot;);
    }
});`

4.2 此处，使用IntentService在后台监听客户端的Socket连接请求，并通过输入输出流来传输文件。此处的代码比较简单，就是在指定端口一直堵塞监听客户端的连接请求，获取待传输的文件信息模型FileTransfer，之后就进行实际的数据传输

    `@Override
    protected void onHandleIntent(Intent intent) {
        clean();
        File file = null;
        try {
            serverSocket = new ServerSocket();
            serverSocket.setReuseAddress(true);
            serverSocket.bind(new InetSocketAddress(PORT));
            Socket client = serverSocket.accept();
            Log.e(TAG, &quot;客户端IP地址 : &quot; + client.getInetAddress().getHostAddress());
            inputStream = client.getInputStream();
            objectInputStream = new ObjectInputStream(inputStream);
            FileTransfer fileTransfer = (FileTransfer) objectInputStream.readObject();
            Log.e(TAG, &quot;待接收的文件: &quot; + fileTransfer);
            String name = new File(fileTransfer.getFilePath()).getName();
            //将文件存储至指定位置
            file = new File(Environment.getExternalStorageDirectory() + &quot;/&quot; + name);
            fileOutputStream = new FileOutputStream(file);
            byte buf[] = new byte[512];
            int len;
            long total = 0;
            int progress;
            while ((len = inputStream.read(buf)) != -1) {
                fileOutputStream.write(buf, 0, len);
                total += len;
                progress = (int) ((total * 100) / fileTransfer.getFileLength());
                Log.e(TAG, &quot;文件接收进度: &quot; + progress);
                if (progressChangListener != null) {
                    progressChangListener.onProgressChanged(fileTransfer, progress);
                }
            }
            serverSocket.close();
            inputStream.close();
            objectInputStream.close();
            fileOutputStream.close();
            serverSocket = null;
            inputStream = null;
            objectInputStream = null;
            fileOutputStream = null;
            Log.e(TAG, &quot;文件接收成功，文件的MD5码是：&quot; + Md5Util.getMd5(file));
        } catch (Exception e) {
            Log.e(TAG, &quot;文件接收 Exception: &quot; + e.getMessage());
        } finally {
            clean();
            if (progressChangListener != null) {
                progressChangListener.onTransferFinished(file);
            }
            //再次启动服务，等待客户端下次连接
            startService(new Intent(this, WifiServerService.class));
        }
    }`

4.3 因为客户端可能会多次发起连接请求，所以当此处理文件传输完成后（不管成功或失败），都需要重新startService，让服务再次堵塞等待客户端的连接请求。

FileTransfer包含三个字段，MD5码值用于校验文件的完整性，fileLength是为了用于计算文件的传输进度。

    `public class FileTransfer implements Serializable {

    //文件路径
    private String filePath;

    //文件大小
    private long fileLength;

    //MD5码
    private String md5;

    ···

}`

4.4 为了将文件传输进度发布到外部界面，所以除了需要启动服务外，界面还需要绑定服务，此处就需要用到一个更新文件传输状态的接口。

    `public interface OnProgressChangListener {

        //当传输进度发生变化时
        void onProgressChanged(FileTransfer fileTransfer, int progress);

        //当传输结束时
        void onTransferFinished(File file);

    }`

4.5 因此，需要将progressChangListener作为参数传给WifiServerService，并在进度变化时更新进度对话框。

    `private WifiServerService.OnProgressChangListener progressChangListener = new WifiServerService.OnProgressChangListener() {
        @Override
        public void onProgressChanged(final FileTransfer fileTransfer, final int progress) {
            runOnUiThread(new Runnable() {
                @Override
                public void run() {
                    progressDialog.setMessage(&quot;文件名： &quot; + new File(fileTransfer.getFilePath()).getName());
                    progressDialog.setProgress(progress);
                    progressDialog.show();
                }
            });
        }

        @Override
        public void onTransferFinished(final File file) {
            runOnUiThread(new Runnable() {
                @Override
                public void run() {
                    progressDialog.cancel();
                    if (file != null &amp;&amp; file.exists()) {
                        openFile(file.getPath());
                    }
                }
            });
        }
    };`
</code></pre><h3 id="5、客户端加入群组并发起文件传输请求"><a href="#5、客户端加入群组并发起文件传输请求" class="headerlink" title="5、客户端加入群组并发起文件传输请求"></a>5、客户端加入群组并发起文件传输请求</h3><pre><code>5.1 文件发送界面SendFileActivity需要实现DirectActionListener接口首先，需要先注册P2P广播，以便获取周边设备信息以及连接状态

    `@Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_send_file);
        initView();
        mWifiP2pManager = (WifiP2pManager) getSystemService(Context.WIFI_P2P_SERVICE);
        mChannel = mWifiP2pManager.initialize(this, getMainLooper(), this);
        broadcastReceiver = new DirectBroadcastReceiver(mWifiP2pManager, mChannel, this);
        registerReceiver(broadcastReceiver, DirectBroadcastReceiver.getIntentFilter());
    }`

5.2 通过discoverPeers方法搜索周边设备，回调函数用于通知方法是否调用成功。

    `mWifiP2pManager.discoverPeers(mChannel, new WifiP2pManager.ActionListener() {
    @Override
    public void onSuccess() {
        showToast(&quot;Success&quot;);
    }

    @Override
    public void onFailure(int reasonCode) {
        showToast(&quot;Failure&quot;);
        loadingDialog.cancel();
     }
});`

5.3 当搜索结束后，系统就会触发WifiP2pManager.WIFI_P2P_PEERS_CHANGED_ACTION广播，此时就可以调用requestPeers方法获取设备列表信息，此处用RecyclerView展示列表，在onPeersAvailable方法刷新列表。

    `mWifiP2pManager.requestPeers(mChannel, new WifiP2pManager.PeerListListener() {
    @Override
    public void onPeersAvailable(WifiP2pDeviceList peers) {
        mDirectActionListener.onPeersAvailable(peers.getDeviceList());
    }
});
@Override
    public void onPeersAvailable(Collection&lt;WifiP2pDevice&gt; wifiP2pDeviceList) {
        Log.e(TAG, &quot;onPeersAvailable :&quot; + wifiP2pDeviceList.size());
        this.wifiP2pDeviceList.clear();
        this.wifiP2pDeviceList.addAll(wifiP2pDeviceList);
        deviceAdapter.notifyDataSetChanged();
        loadingDialog.cancel();
    }`

5.4 之后，通过点击事件选中群主（服务器端）设备，通过连接方法请求与之进行连接

    `private void connect() {
    WifiP2pConfig config = new WifiP2pConfig();
    if (config.deviceAddress != null &amp;&amp; mWifiP2pDevice != null) {
        config.deviceAddress = mWifiP2pDevice.deviceAddress;
        config.wps.setup = WpsInfo.PBC;
        showLoadingDialog(&quot;正在连接 &quot; + mWifiP2pDevice.deviceName);
        mWifiP2pManager.connect(mChannel, config, new WifiP2pManager.ActionListener() {
            @Override
            public void onSuccess() {
                Log.e(TAG, &quot;connect onSuccess&quot;);
            }

            @Override
            public void onFailure(int reason) {
                showToast(&quot;连接失败 &quot; + reason);
                dismissLoadingDialog();
            }
        });
    }
}`

5.5 此处依然无法通过函数函数来判断连接结果，需要依靠系统发出的WifiP2pManager.WIFI_P2P_CONNECTION_CHANGED_ACTION   方法来获取到连接结果，在此处可以通过requestConnectionInfo获取到组连接信息，信息最后通过onConnectionInfoAvailable方法传递出来，在此可以判断当前设备是否为群主，获取群组IP地址。

    `@Override
public void onConnectionInfoAvailable(WifiP2pInfo wifiP2pInfo) {
    dismissLoadingDialog();
    wifiP2pDeviceList.clear();
    deviceAdapter.notifyDataSetChanged();
    btn_disconnect.setEnabled(true);
    btn_chooseFile.setEnabled(true);
    Log.e(TAG, &quot;onConnectionInfoAvailable&quot;);
    Log.e(TAG, &quot;onConnectionInfoAvailable groupFormed: &quot; + wifiP2pInfo.groupFormed);
    Log.e(TAG, &quot;onConnectionInfoAvailable isGroupOwner: &quot; + wifiP2pInfo.isGroupOwner);
    Log.e(TAG, &quot;onConnectionInfoAvailable getHostAddress: &quot; + wifiP2pInfo.groupOwnerAddress.getHostAddress());
    StringBuilder stringBuilder = new StringBuilder();
    if (mWifiP2pDevice != null) {
        stringBuilder.append(&quot;连接的设备名：&quot;);
        stringBuilder.append(mWifiP2pDevice.deviceName);
        stringBuilder.append(&quot;\n&quot;);
        stringBuilder.append(&quot;连接的设备的地址：&quot;);
        stringBuilder.append(mWifiP2pDevice.deviceAddress);
    }
    stringBuilder.append(&quot;\n&quot;);
    stringBuilder.append(&quot;是否群主：&quot;);
    stringBuilder.append(wifiP2pInfo.isGroupOwner ? &quot;是群主&quot; : &quot;非群主&quot;);
    stringBuilder.append(&quot;\n&quot;);
    stringBuilder.append(&quot;群主IP地址：&quot;);
    stringBuilder.append(wifiP2pInfo.groupOwnerAddress.getHostAddress());
    tv_status.setText(stringBuilder);
    if (wifiP2pInfo.groupFormed &amp;&amp; !wifiP2pInfo.isGroupOwner) {
        this.wifiP2pInfo = wifiP2pInfo;
    }
}`

5.6 至此服务器端和客户端已经通过Wifi P2P连接在了一起，客户端也获取到了服务器端的IP地址，在选取好待发送的文件后就可以主动发起对服务器端的连接请求了。

5.7 发起选取文件的方法

    `Intent intent = new Intent(Intent.ACTION_GET_CONTENT);
    intent.setType(&quot;*/*&quot;);
    intent.addCategory(Intent.CATEGORY_OPENABLE);
    startActivityForResult(intent, 1);`

5.8 获取选取的文件的实际路径

    `@Override
    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
        super.onActivityResult(requestCode, resultCode, data);
        if (requestCode == 1) {
            if (resultCode == RESULT_OK) {
                Uri uri = data.getData();
                if (uri != null) {
                    String path = getPath(this, uri);
                    if (path != null) {
                        File file = new File(path);
                        if (file.exists() &amp;&amp; wifiP2pInfo != null) {
                            FileTransfer fileTransfer = new FileTransfer(file.getPath(), file.length());
                            Log.e(TAG, &quot;待发送的文件：&quot; + fileTransfer);
                            new WifiClientTask(this, fileTransfer).execute(wifiP2pInfo.groupOwnerAddress.getHostAddress());
                        }
                    }
                }
            }
        }
    }

    private String getPath(Context context, Uri uri) {
        if (&quot;content&quot;.equalsIgnoreCase(uri.getScheme())) {
            Cursor cursor = context.getContentResolver().query(uri, new String[]{&quot;_data&quot;}, null, null, null);
            if (cursor != null) {
               if (cursor.moveToFirst()) {
                    String data = cursor.getString(cursor.getColumnIndex(&quot;_data&quot;));
                    cursor.close();
                    return data;
                }
            }
        } else if (&quot;file&quot;.equalsIgnoreCase(uri.getScheme())) {
            return uri.getPath();
        }
        return null;
    }`

5.9 文件的发送操作放到AsyncTask中处理，将服务器端的IP地址作为参数传进来，在正式发送文件前，先发送包含文件信息（文件名，文件大小，文件MD5码）的信息模型FileTransfer，并在发送文件的过程中同时更新进度

    `public class WifiClientTask extends AsyncTask&lt;String, Integer, Boolean&gt; {

        private ProgressDialog progressDialog;

        private FileTransfer fileTransfer;

        private static final int PORT = 4786;

        private static final String TAG = &quot;WifiClientTask&quot;;

        public WifiClientTask(Context context, FileTransfer fileTransfer) {
            this.fileTransfer = fileTransfer;
            progressDialog = new ProgressDialog(context);
            progressDialog.setProgressStyle(ProgressDialog.STYLE_HORIZONTAL);
            progressDialog.setCancelable(false);
            progressDialog.setCanceledOnTouchOutside(false);
            progressDialog.setTitle(&quot;正在发送文件&quot;);
            progressDialog.setMax(100);
        }

        @Override
        protected void onPreExecute() {
            progressDialog.show();
        }

        @Override
        protected Boolean doInBackground(String... strings) {
            fileTransfer.setMd5(Md5Util.getMd5(new File(fileTransfer.getFilePath())));
            Log.e(TAG, &quot;文件的MD5码值是：&quot; + fileTransfer.getMd5());
            Socket socket = null;
            OutputStream outputStream = null;
            ObjectOutputStream objectOutputStream = null;
            InputStream inputStream = null;
            try {
                socket = new Socket();
                socket.bind(null);
                socket.connect((new InetSocketAddress(strings[0], PORT)), 10000);
                outputStream = socket.getOutputStream();
                objectOutputStream = new ObjectOutputStream(outputStream);
                objectOutputStream.writeObject(fileTransfer);
                inputStream = new FileInputStream(new File(fileTransfer.getFilePath()));
                long fileSize = fileTransfer.getFileLength();
                long total = 0;
                byte buf[] = new byte[512];
                int len;
                while ((len = inputStream.read(buf)) != -1) {
                    outputStream.write(buf, 0, len);
                    total += len;
                    int progress = (int) ((total * 100) / fileSize);
                    publishProgress(progress);
                    Log.e(TAG, &quot;文件发送进度：&quot; + progress);
                }
                outputStream.close();
                objectOutputStream.close();
                inputStream.close();
                socket.close();
                outputStream = null;
                objectOutputStream = null;
                inputStream = null;
                socket = null;
                Log.e(TAG, &quot;文件发送成功&quot;);
                return true;
            } catch (Exception e) {
                Log.e(TAG, &quot;文件发送异常 Exception: &quot; + e.getMessage());
            } finally {
                if (outputStream != null) {
                    try {
                        outputStream.close();
                    } catch (IOException e) {
                        e.printStackTrace();
                    }
                }
                if (objectOutputStream != null) {
                    try {
                        objectOutputStream.close();
                    } catch (IOException e) {
                        e.printStackTrace();
                    }
                }
                if (inputStream != null) {
                    try {
                        inputStream.close();
                    } catch (IOException e) {
                        e.printStackTrace();
                    }
                }
                if (socket != null) {
                    try {
                        socket.close();
                    } catch (Exception e) {
                        e.printStackTrace();
                    }
                }
            }
            return false;
        }

        @Override
        protected void onProgressUpdate(Integer... values) {
            progressDialog.setProgress(values[0]);
        }

        @Override
        protected void onPostExecute(Boolean aBoolean) {
            progressDialog.cancel();
            Log.e(TAG, &quot;onPostExecute: &quot; + aBoolean);
        }

    }`
</code></pre><h3 id="6、校验文件完整性"><a href="#6、校验文件完整性" class="headerlink" title="6、校验文件完整性"></a>6、校验文件完整性</h3><pre><code>6.1 传输文件的完整性主要是通过计算文件的MD5码值来保证了，在发送文件前，即在WifiClientTask的doInBackground方法中进行计算，将MD5码值赋给给FileTransfer模型，通过如下方法计算得到

    `public class Md5Util {

    public static String getMd5(File file) {
        InputStream inputStream = null;
        byte[] buffer = new byte[2048];
        int numRead;
        MessageDigest md5;
        try {
            inputStream = new FileInputStream(file);
            md5 = MessageDigest.getInstance(&quot;MD5&quot;);
            while ((numRead = inputStream.read(buffer)) &gt; 0) {
                md5.update(buffer, 0, numRead);
            }
            inputStream.close();
            inputStream = null;
            return md5ToString(md5.digest());
        } catch (Exception e) {
            return null;
        } finally {
            if (inputStream != null) {
                try {
                    inputStream.close();
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        }
    }

    private static String md5ToString(byte[] md5Bytes) {
        StringBuilder hexValue = new StringBuilder();
        for (byte b : md5Bytes) {
            int val = ((int) b) &amp; 0xff;
            if (val &lt; 16) {
                hexValue.append(&quot;0&quot;);
            }
            hexValue.append(Integer.toHexString(val));
        }
        return hexValue.toString();
    }

}`
</code></pre>
          
        
      
    </div>
    
    
    
	
	<div>
		
	</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/30/13_Matlab_Simulink/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JunBoXu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LgStars">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/30/13_Matlab_Simulink/" itemprop="url">Simulink电路仿真</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-30T09:48:00+08:00">
                2018-03-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Matlab/" itemprop="url" rel="index">
                    <span itemprop="name">Matlab</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/30/13_Matlab_Simulink/" class="leancloud_visitors" data-flag-title="Simulink电路仿真">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
				 <span>°C</span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h6 id="博客录语-—-生命之灯因热情而点燃，生命之舟因拼搏而前行。"><a href="#博客录语-—-生命之灯因热情而点燃，生命之舟因拼搏而前行。" class="headerlink" title="博客录语  —  生命之灯因热情而点燃，生命之舟因拼搏而前行。"></a>博客录语  —  生命之灯因热情而点燃，生命之舟因拼搏而前行。</h6><h2 id="Simulink入门实用"><a href="#Simulink入门实用" class="headerlink" title="Simulink入门实用"></a>Simulink入门实用</h2><h3 id="1、Simulink说明"><a href="#1、Simulink说明" class="headerlink" title="1、Simulink说明"></a>1、Simulink说明</h3><pre><code>1.1 Simulink 是MATLAB 的一个重要的工具箱，是结合了框图界面和交互仿真能力的系统级设计和仿真工具。它以MATLAB 核心数学，图形和语言为基础，可以让用户完成从算法开发，仿真或者模型验证的全过程，而不需要传递数据，重写代码或改变软件环境。
</code></pre><h3 id="2、Simulink功能和优点"><a href="#2、Simulink功能和优点" class="headerlink" title="2、Simulink功能和优点"></a>2、Simulink功能和优点</h3><pre><code>2.1 用方框图的绘制代替了程序的编写。构成任何一个系统框图有三个步骤，即选定典型环节，相互联结和给定环节参数。

2.2 仿真的建立和运行是智能化的。首先，画好了框图并存起来，Simulink自动建立一个仿真的过程；其次，在运行时用户可以不给步长，只给出要求的仿真精度，软件会自动选择能保证给定精度的最大步长，使得在给定的精度要求下系统仿真具有最快的速度。   

2.3 输入输出信号来源形式的多样化。其输入信号可以是各种信号发生器；也可以来自一个设定的记录文件；还可以来自MATLAB的工作空间（workspace）.输出信号也类似，这就扩大了仿真系统与各种外部软件和硬件的接口能力。
</code></pre><h3 id="3、Simulink模块介绍"><a href="#3、Simulink模块介绍" class="headerlink" title="3、Simulink模块介绍"></a>3、Simulink模块介绍</h3><pre><code>3.1 Sources模块介绍

    3.1.1 Step -- 阶跃函数，起始时间是第1秒而非0秒。双击step模块，对仿真起始时间(step time)和阶跃值(Initial value, Final value)的大小进行设置。

    3.1.2 Signal Generator -- 信号发生器，可以产生给定频率和幅值的正弦波(sine wave)、方波(square wave)和锯齿波(sawtooth wave)，双击图标可以设置。

    3.1.3 Clock -- 定时器，显示仿真时间，在系统仿真时打开定时器，可以看到实时的仿真时间。 

    3.1.4 Sine Wave -- 正弦波，电路中常用到的正弦信号（Sine Wave）模块，双击图标，在弹出的窗口中调整相关参数。信号生成方式有两种：Time based 和 Sample based 。

        注：
            （1）如果以Time based 方式运行该模块，则需要用户设定波形的幅度（Amplitude）、偏移（Bias）、频率（Frequency）、初相（Phase）几个参数；

            （2）如果选择Sample based方式，参数设置则为幅度（Amplitude）、偏移（Bias)、每周期采样数（Sampies per period）和偏移采样数（Number of offset samples）。

            （3）两种工作方式中的各项参数都可以用关系式加以换算：
                每周期采样数=2*pi/（频率*采样时间）
                频移采样数=初相*每周期采样数/（2*pi）

            （4）设置采样时间Sampletime ,将此参数设置为零时表示以连续的方式工作，将此参数设置为大于零的值时则以所设采样时间工作。但要注意的是采用Sample based 模式的模块式不能以连续的方式工作的。


    3.1.5 From Workspace --  从工作空间输入。从MATLAB Workspace输入已有的函数作为仿真的激励信号。首先要在MATLAB环境下建立一个时间向量和相应的函数值向量，然后将时间向量和函数值向量的名称[T, U]填入该图标的对话框中。

3.2 Math Operations模块

    3.2.1 加、减运算 在List of signs文本框中可以选择多个数的加、减法运算。在Icon shape中选择圆形或方形符号。 

    3.2.2 Gain： 增益  作为后续模块的增益系数。

3.3 Continuous模块

    3.3.1 Transfer Fcn 传递函数，设置 numerator选项，分子多项式系数的降幂排列。 Denominator选项，分母多项式系数的降幂排列。 

3.4 Sinks模块

    3.4.1 To workspace -- 输出到工作空间，功能与From Workspace正好相反，把仿真结果连同输入信号输出到工作空间去。

    3.4.2 XY示波器 -- 显示 MATLAB的图形窗口。输入曲线是以时间为横轴的绘图区域。

    3.4.3 Display -- 它的作用是将信号值直接显示在该模块的窗口中。输出信号是个直流信号时，我们就可以把它直接送到这个模块中，从模块窗口中直接读出输入信号的大小。

    3.4.4 Scope -- 示波器模块可以接受多个输入信号，每个端口的输入信号都将在一个坐标轴中显示。如果是向量或矩阵信号，则以不同的颜色表示每个元素信号；如果信号本身是离散的，则显示信号的阶梯图。
</code></pre><h3 id="4、Simulink实例"><a href="#4、Simulink实例" class="headerlink" title="4、Simulink实例"></a>4、Simulink实例</h3><pre><code>4.1 建立simulink
</code></pre><p><img src="https://i.imgur.com/LSlsKix.png" alt=""></p>
<pre><code>4.2 打开simulink库，其中关于电子器件在Simscape/Power Systems/下

4.3 建立实例
</code></pre><p><img src="https://i.imgur.com/pumgrUG.png" alt=""></p>
<pre><code>4.4 仿真完成图
</code></pre><p><img src="https://i.imgur.com/PYpf3Z5.png" alt=""></p>
<pre><code>注：在完成图后，一定要加powergui块（上图右下角）。
</code></pre>
          
        
      
    </div>
    
    
    
	
	<div>
		
	</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/29/12_RecyclerView/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JunBoXu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LgStars">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/29/12_RecyclerView/" itemprop="url">RecyclerView分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-29T18:25:00+08:00">
                2018-03-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/29/12_RecyclerView/" class="leancloud_visitors" data-flag-title="RecyclerView分析">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
				 <span>°C</span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h6 id="博客录语-—-成功是别人失败时还在坚持。"><a href="#博客录语-—-成功是别人失败时还在坚持。" class="headerlink" title="博客录语  —  成功是别人失败时还在坚持。"></a>博客录语  —  成功是别人失败时还在坚持。</h6><h2 id="RecyclerView"><a href="#RecyclerView" class="headerlink" title="RecyclerView"></a>RecyclerView</h2><h3 id="1、RecyclerView说明"><a href="#1、RecyclerView说明" class="headerlink" title="1、RecyclerView说明"></a>1、RecyclerView说明</h3><pre><code>（1）RecyclerView是一个用来显示庞大数据集的容器，可通过保持有限数量的视图进行非常有效
    的滚动操作。

（2）如果有数据集合，其中的元素将因用户操作或网络事件而发生变化，建议使用
    RecyclerView。
</code></pre><h3 id="2、RecyclerView原理"><a href="#2、RecyclerView原理" class="headerlink" title="2、RecyclerView原理"></a>2、RecyclerView原理</h3><pre><code>（1）RecyclerView与优化后的ListView原理类似：都是仅仅维护少量的View，并且可以用来展
    示大量的数据集。
</code></pre><h3 id="3、RecyclerView使用方法"><a href="#3、RecyclerView使用方法" class="headerlink" title="3、RecyclerView使用方法"></a>3、RecyclerView使用方法</h3><pre><code>（1）使用RecyclerView需要创建一个Adapter和一个LayoutManager类。

（2）RecyclerView

    LayoutManager  →  Adapter  →  Dataset

 注：

    Adapter：使用RecyclerView之前，需要继承一个RecyclerView.Adapter的适配器，作用是将数据与每个item的界面进行绑定。

    LayoutManager：用来确定每一个item如何进行排列摆放，何时展示和隐藏。回收或重用一个view时，LayoutManager会向适配器请求新的数据来替换旧的数据，这种机制避免了创建过多的view和频繁的调用findviewbyid方法（与listview优化后的原理类似）。

（3）RecyclerView提供了下面3种内置的布局管理器（LayoutManager）。

    （1）LinearLayoutManager以垂直或水平滚动列表方式显示项目。

    （2）GridLayoutManager表格布局，效果类似GridView。

    （3）StaggeredGridLayoutManager流式布局，例如瀑布流效果，当然还可以继承RecyclerView.LayoutManager来实现一个自定义的LayoutManager。
</code></pre><h3 id="4、RecyclerView实用例程"><a href="#4、RecyclerView实用例程" class="headerlink" title="4、RecyclerView实用例程"></a>4、RecyclerView实用例程</h3><pre><code>4.1 添加依赖

    （1）使用RecyclerView需要在App/build.gradle中添加依赖，然后同步一下。

        `dependencies {
                compile fileTree(include: [&apos;*.jar&apos;], dir: &apos;libs&apos;)
                androidTestCompile(&apos;com.android.support.test.espresso:espresso-core:2.2.2&apos;, {
                    exclude group: &apos;com.android.support&apos;, module: &apos;support-annotations&apos;
                })
                compile &apos;com.android.support:appcompat-v7:26.0.0-alpha1&apos;
                testCompile &apos;junit:junit:4.12&apos;
                compile &apos;com.android.support:recyclerview-v7:26.0.0-alpha1&apos;
            }`

4.2 编写代码

    （1）在xml中创建一个RecyclerView的布局。

        `&lt;android.support.v7.widget.RecyclerView
            android:id=&quot;@+id/recycler_view&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;match_parent&quot;
            android:scrollbars=&quot;vertical&quot;/&gt;`

    （2）创建完之后在Activity中获取这个RecyclerView，并声明LayoutManager与Adapter。

            `RecyclerView recyclerView = (RecyclerView)     findViewById(R.id.recycler_view);
             initDatas();
             RecyclerView.LayoutManager LayoutManager = new LinearLayoutManager(this);
             recyclerView.setLayoutManager(LayoutManager);
             //如果每个item的高度的固定的，设置这个选项可以提高性能
             recyclerView.setHasFixedSize(true);
             MyAdapter adapter = new MyAdapter(datas);
             recyclerView.setAdapter(adapter);`

    （3）RecyclerView与listview一样，也是需要适配器的，但是，RecyclerView需要设置布局管理器的，这是为了方便扩展，这里使用了LinearLayoutManager，其中Adapter的创建比较关键。

        `package com.note.recyclerview;
            public class MyAdapter extends RecyclerView.Adapter&lt;MyAdapter.ViewHolder&gt; {

                private List&lt;String&gt; datas = null;

                public MyAdapter(List&lt;String&gt; datas){
                    this.datas = datas;
                }

                /**
                 * 创建View,被LayoutManager所调用
                 * @param parent
                 * @param viewType
                 * @return
                 */
                @Override
                public MyAdapter.ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {

                    LayoutInflater inflater = LayoutInflater.from(parent.getContext());
                    //把布局换成view对象，参数1布局，参数2父容器，参数3是否主动挂载到父容器上
                    View view = inflater.inflate(R.layout.item,parent,false);
                    ViewHolder vh = new ViewHolder(view);

                    return vh;
                }

                /**
                 * 将界面与数据进行绑定
                 * @param holder
                 * @param position
                 */
                @Override
                public void onBindViewHolder(ViewHolder holder, int position) {
                    holder.mTextview.setText(datas.get(position));
                }

                /**
                 * 获取数据的数量
                 * @return
                 */
                @Override
                public int getItemCount() {
                    return datas.size();
                }

                /**
                 * 自定义的ViewHolder，持有每个item的所有界面元素
                 */
                public static class ViewHolder extends RecyclerView.ViewHolder {
                    private TextView mTextview;
                    public ViewHolder(View itemView) {
                        super(itemView);
                        mTextview = itemView.findViewById(R.id.text_view);
                    }
                }
            }
            `    
    （4）MyAdapter继承RecyclerView.Adapter，需要一个ViewHolder的泛型，强制必须建立一个ViewHolder，创建一个ViewHolder并继承RecyclerView.ViewHolder,ViewHolder构造方法需要传递View对象，View对象会和ViewHolder进行绑定。

4.3 效果图
</code></pre><p><img src="https://i.imgur.com/tz1wKXn.png" alt=""></p>
<h3 id="5、RecyclerView实用扩展"><a href="#5、RecyclerView实用扩展" class="headerlink" title="5、RecyclerView实用扩展"></a>5、RecyclerView实用扩展</h3><pre><code>5.1 横向布局

    （1）如果想要一个横向的布局列表，只要设置LinearLayoutManager就行，注意，要声明LayoutManager的类型是LinearLayoutManager，而不是父类的LayoutManager:

        `LinearLayoutManager LayoutManager = new LinearLayoutManager(this);
        LayoutManager.setOrientation(LinearLayoutManager.HORIZONTAL);`

    （2）如果要显示滚动条，需要在布局中修改RecyclerView属性，把滚动的的方向改为水平方向：

        `android:scrollbars=&quot;horizontal&quot;`

5.2 Grid布局

    （1）代码：
        `GridLayoutManager LayoutManager = new GridLayoutManager(this,3);`

    （2）效果图：
</code></pre><p><img src="https://i.imgur.com/q4kJo6P.png" alt=""></p>
<pre><code>5.3 瀑布流布局

    （1）瀑布流使用 StaggeredGridLayoutManager：

        `StaggeredGridLayoutManager LayoutManager =
            new StaggeredGridLayoutManager(3,StaggeredGridLayoutManager.VERTICAL);`

    （2）如果第二个参数传入StaggeredGridLayoutManager.VERTICAL，那么第一个参数代表有多少列，反之亦然；

    （3）效果图：
</code></pre><p><img src="https://i.imgur.com/2ZI7hPx.png" alt=""></p>

          
        
      
    </div>
    
    
    
	
	<div>
		
	</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/28/11_GridView/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JunBoXu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LgStars">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/28/11_GridView/" itemprop="url">GridView分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-28T14:09:00+08:00">
                2018-03-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/28/11_GridView/" class="leancloud_visitors" data-flag-title="GridView分析">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
				 <span>°C</span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h6 id="博客录语-—-凡事要三思，但比三思更重要的是三思而行。"><a href="#博客录语-—-凡事要三思，但比三思更重要的是三思而行。" class="headerlink" title="博客录语  —  凡事要三思，但比三思更重要的是三思而行。"></a>博客录语  —  凡事要三思，但比三思更重要的是三思而行。</h6><h2 id="GridView分析"><a href="#GridView分析" class="headerlink" title="GridView分析"></a>GridView分析</h2><blockquote>
<p>ListView一般用于列表项的展示，GridView一般用于制作某些选项按钮上，常见的九宫格就可以用<br>GridView来实现。</p>
</blockquote>
<p>|| <em>属性</em> || <em>相关方法</em> || <em>说明</em> ||</p>
<p>|| android:columnWidth=”” || setColumnWidth(int) || 设置列的宽度 ||</p>
<p>|| android:horizontalSpacing=”” || setHorizontalSpacing(int) || 定义列之间的水平间距 ||</p>
<p>|| android:numColumns=”” || setNumColumns(int) || 设置列数 ||</p>
<p>|| android:verticalSpacing=”” || setVerticalSpacing(int) || 定义行之间默认的垂直间距 ||</p>
<p>|| android:stretchMode=””  || setStretchMode() || 缩放模式 ||</p>
<pre><code>（1）代码

    ` setContentView(R.layout.activity_main);

    grid_view = (GridView) findViewById(R.id.grid_view);

    //初始化数据
    initDatas();

    final NumberAdapter adapter = new NumberAdapter(this,R.layout.item_list,numberList);

    grid_view.setAdapter(adapter);`

（2）图片

    ![](https://i.imgur.com/9spNZPg.png)
</code></pre>
          
        
      
    </div>
    
    
    
	
	<div>
		
	</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/28/10_listview分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JunBoXu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LgStars">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/28/10_listview分析/" itemprop="url">ListView分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-28T08:30:00+08:00">
                2018-03-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/28/10_listview分析/" class="leancloud_visitors" data-flag-title="ListView分析">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
				 <span>°C</span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h6 id="博客录语-—-每一日你所付出的代价都比前一日高，因为你的生命又消短了一天，所以每一日你都要更用心。"><a href="#博客录语-—-每一日你所付出的代价都比前一日高，因为你的生命又消短了一天，所以每一日你都要更用心。" class="headerlink" title="博客录语  —  每一日你所付出的代价都比前一日高，因为你的生命又消短了一天，所以每一日你都要更用心。"></a>博客录语  —  每一日你所付出的代价都比前一日高，因为你的生命又消短了一天，所以每一日你都要更用心。</h6><h2 id="一、ListView分析"><a href="#一、ListView分析" class="headerlink" title="一、ListView分析"></a>一、ListView分析</h2><blockquote>
<p>listview的设计理念，采用适配器设计模式，让数据和界面分离，更利于扩展和维护。</p>
</blockquote>
<h3 id="listview的组成"><a href="#listview的组成" class="headerlink" title="listview的组成"></a>listview的组成</h3><p>1、listview控件。</p>
<p>2、适配器类，用到了设计模式中的适配器模式，它是视图和数据之间的桥梁，负责提供对数据的访问，生成每一个列表项对应的view。</p>
<pre><code>常用的的模式：

        （1）ArrayAdapter

        （2）SimpleAdapter

        （3）BaseAdapter
</code></pre><p>3、数据源。</p>
<h4 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h4><pre><code>（1）代码

`String[] datas = {&quot;第一&quot;,&quot;第二&quot;,&quot;第二&quot;,&quot;第二&quot;,&quot;第二&quot;,&quot;第二&quot;,&quot;第二&quot;,&quot;第二&quot;,
        &quot;第二&quot;,&quot;第二&quot;,&quot;第四&quot;,&quot;第二&quot;,&quot;第二&quot;,&quot;第二&quot;,&quot;第二&quot;,&quot;第二&quot;,&quot;第三&quot;,
        &quot;第二&quot;,&quot;第二&quot;,&quot;第五&quot;,};`

`listview = (ListView) findViewById(R.id.listview);

    ArrayAdapter adapter = new ArrayAdapter(this,android.R.layout.simple_list_item_1,datas);

    listview.setAdapter(adapter);`

（2）效果图

![](https://i.imgur.com/9ssFaZi.png)
</code></pre><h2 id="二、定制ListView效果图"><a href="#二、定制ListView效果图" class="headerlink" title="二、定制ListView效果图"></a>二、定制ListView效果图</h2><blockquote>
<p>多功能展示UI。</p>
</blockquote>
<blockquote>
<p>字符串类型已经不能满足我们的要求了，需要定义一个实体类，作为listview的适配器的适配类型（也就是数据）。</p>
</blockquote>
<p>1、首先定义一个Number实体类</p>
<pre><code>`public class Number {
    private String number;
    private int imageId;

    public int getImageId() {
        return imageId;
    }
    public String getNumber() {
        return number;
    }
    public Number(String number,int imageId){
        this.number = number;
        this.imageId = imageId;
    }
}`
</code></pre><p>2、自定义一个适配器NumberAdapter，这个适配器继承ArrayAdapter，并将泛指指定为Number类。</p>
<pre><code>`public class NumberAdapter extends ArrayAdapter {

    int resourceId;
    public NumberAdapter(Context context, int resource, List objects) {
        super(context, resource, objects);
        resourceId = resource;//记录布局资源的Id
    }
    //position是当前的位置，从0开始计数
    public View getView(int position, View convertView, ViewGroup parent){

        Number number = (Number) getItem(position);//获取当前条目的数据实例
        //把xml换成view对象
        View view = View.inflate(getContext(),resourceId,null);
        ImageView imageView = view.findViewById(R.id.iv_flag);
        TextView textView = view.findViewById(R.id.tv_name);
        //设置数据
        imageView.setImageResource(number.getImageId());
        textView.setText(number.getNumber());
        return view;
    }
}`

注：NumberAdapter重写了父类的构造函数，用于将上下文、ListView子项的布局ID和数据传递进来。另外重写了getview（）方法，这个方法在每个子项滚出屏幕内时会被调用。
</code></pre><blockquote>
<p>现在我们做好了适配器（相当于系统自带的ArrayAdapter）。</p>
</blockquote>
<p>3、下面在MainActivity中开始应用。</p>
<pre><code>（1）代码

`public class MainActivity extends AppCompatActivity {

    private ListView listview;

    private List&lt;Number&gt; numberList = new ArrayList&lt;&gt;();

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        listview = (ListView) findViewById(R.id.list_view);

        //初始化数据
        initDatas();

        NumberAdapter adapter = new NumberAdapter(this,R.layout.item_list,numberList);

        listview.setAdapter(adapter);
    }

    private void initDatas() {
        numberList.add(new Number(&quot;1&quot;,R.mipmap.ic_launcher));
        numberList.add(new Number(&quot;1&quot;,R.mipmap.ic_launcher));
        numberList.add(new Number(&quot;5&quot;,R.mipmap.ic_launcher));
        numberList.add(new Number(&quot;4&quot;,R.mipmap.ic_launcher));
        numberList.add(new Number(&quot;2&quot;,R.mipmap.ic_launcher));
        numberList.add(new Number(&quot;3&quot;,R.mipmap.ic_launcher));



    }
}`

（2）图片

![](https://i.imgur.com/9d8miqL.png)
</code></pre><h2 id="三、优化ListView"><a href="#三、优化ListView" class="headerlink" title="三、优化ListView"></a>三、优化ListView</h2><blockquote>
<p>NumberAdapter的getView()方法中每次都会把布局重新加载一遍，当listview快速滑动时就会发现<br>程序卡顿甚至奔溃。</p>
</blockquote>
<blockquote>
<p>仔细观察，getView()方法还有一个convertView参数，这个参数用于将之前加载好的布局进行缓<br>存，以便以后可以重新引用。</p>
</blockquote>
<pre><code>`View view;
    Number number = (Number) getItem(position);//获取当前条目的数据实例
    if (convertView == null){
        //把xml换成view对象
        view = View.inflate(getContext(),resourceId,null);
    }else {
        view = convertView;
    }
    ImageView imageView = view.findViewById(R.id.iv_flag);
    TextView textView = view.findViewById(R.id.tv_name);
    //设置数据
    imageView.setImageResource(number.getImageId());
    textView.setText(number.getNumber());
    return view;`
</code></pre><blockquote>
<p> 但是这份代码是可以继续优化的，无论是通过inflate()可以加载布局，还是复用convertView，都<br> 会调用findviewbyid()方法去初始化控件，这步操作也是可以复用的。</p>
</blockquote>
<blockquote>
<p>创建一个内部类ViewHolder,继续优化代码。</p>
</blockquote>
<pre><code>`public class NumberAdapter extends ArrayAdapter {

    int resourceId;
    public NumberAdapter(Context context, int resource, List objects) {
        super(context, resource, objects);
        resourceId = resource;//记录布局资源的Id
    }
    //position是当前的位置，从0开始计数
    public View getView(int position, View convertView, ViewGroup parent){
        View view;

        ViewHolder viewHolder = null;
        Number number = (Number) getItem(position);//获取当前条目的数据实例
        if (convertView == null){

            viewHolder = new ViewHolder();

            //把xml换成view对象
            view = View.inflate(getContext(),resourceId,null);
            viewHolder.imageView = view.findViewById(R.id.iv_flag);
            viewHolder.textView = view.findViewById(R.id.tv_name);
            view.setTag(viewHolder);//将viewHolder保存在view对象中
        }else {
            view = convertView;
            viewHolder = (ViewHolder) view.getTag();
        }
        //设置数据
        viewHolder.imageView.setImageResource(number.getImageId());
        viewHolder.textView.setText(number.getNumber());
        return view;
    }

    static class ViewHolder{
        ImageView imageView;
        TextView textView;
    }
}`
</code></pre><blockquote>
<p>当convertView为空时，创建一个viewHolder对象，并将空间的实例都存放在viewHolder中，然后<br>调用了View的setTag()方法，将viewHolder存放在View中。</p>
</blockquote>
<blockquote>
<p>当convertView不为空时，把viewHolder取出来。这样所有的控件的实例都缓存在了viewHolder<br>中。</p>
</blockquote>
<h2 id="四、ListView点击事件"><a href="#四、ListView点击事件" class="headerlink" title="四、ListView点击事件"></a>四、ListView点击事件</h2><blockquote>
<p>点击返回条目位置</p>
</blockquote>
<pre><code>`/**
     * adapterView  指的是listview
     * view    指的是被点击的条目
     * i 条目的位置
     * L id如果adapter继承arrayadapter，则l与i相同
     */
    listview.setOnItemClickListener(new AdapterView.OnItemClickListener() {
        @Override
        public void onItemClick(AdapterView&lt;?&gt; adapterView, View view, int i, long l) {
            Toast.makeText(MainActivity.this,&quot;position:&quot; + i,Toast.LENGTH_SHORT).show();
        }
    });`
</code></pre><blockquote>
<p>除了条目的点击事件，listview还可以设置条目的长按设置</p>
</blockquote>
<pre><code>`/**
     * adapterView  指的是listview
     * view    指的是被点击的条目
     * i 条目的位置
     * L id如果adapter继承arrayadapter，则l与i相同
     */
    listview.setOnItemLongClickListener(new AdapterView.OnItemLongClickListener() {
        @Override
        public boolean onItemLongClick(AdapterView&lt;?&gt; adapterView, View view, int i, long l) {
            numberList.remove(i);//删除长按位置的数据
            adapter.notifyDataSetChanged();//刷新listview界面
            return true;
            //return false;
        }
    });`
</code></pre><blockquote>
<p>但是这个有一个返回值，代表是否消费掉这个事件。</p>
</blockquote>
<blockquote>
<p>当返回值为false时，处理完条目的长按事件，还会处理条目的点击事件</p>
</blockquote>
<blockquote>
<p>当返回值为true时，则表示处理完条目的长按事件，不会再处理条目的点击事件了</p>
</blockquote>
<h2 id="五、ListView常用属性"><a href="#五、ListView常用属性" class="headerlink" title="五、ListView常用属性"></a>五、ListView常用属性</h2><blockquote>
<p>android:divider 设置分割线的颜色或者指定分割线的图片</p>
</blockquote>
<blockquote>
<p>android:dividerHeight 设置分割线的高度</p>
</blockquote>
<blockquote>
<p>android:scrollbars=”none” 隐藏滚动条</p>
</blockquote>

          
        
      
    </div>
    
    
    
	
	<div>
		
	</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-图片特效、Matric" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/19/9_图片特效/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JunBoXu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LgStars">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/19/9_图片特效/" itemprop="url">图片特效、Matrix</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-19T19:55:00+08:00">
                2018-03-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/19/9_图片特效/" class="leancloud_visitors" data-flag-title="图片特效、Matrix">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
				 <span>°C</span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="图片特效、Matric"><a href="#图片特效、Matric" class="headerlink" title="图片特效、Matric"></a>图片特效、Matric</h2><blockquote>
<p>图片的特效包括图形的缩放、镜面、倒影、旋转、位移等。</p>
</blockquote>
<blockquote>
<p>图片的特效是将原图的图形矩阵乘以一个特效矩阵，形成一个新的图形矩阵来实现的。</p>
</blockquote>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3>
          
        
      
    </div>
    
    
    
	
	<div>
		
	</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-Android图片、水印" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/19/8_图片加水印/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JunBoXu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LgStars">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/19/8_图片加水印/" itemprop="url">图片加水印</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-19T19:20:00+08:00">
                2018-03-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/19/8_图片加水印/" class="leancloud_visitors" data-flag-title="图片加水印">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
				 <span>°C</span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="图片加水印"><a href="#图片加水印" class="headerlink" title="图片加水印"></a>图片加水印</h2><blockquote>
<p>Android提供两个类：Canvas 和 Paint:</p>
</blockquote>
<blockquote>
<p>Canvas 画画板，用于绘制各种图形（点、线、圆、矩形等）。</p>
</blockquote>
<blockquote>
<p>Paint 画笔，和Canvas搭配使用，用于制定各种绘制的颜色、线条的粗细、过渡、渐变等效果。</p>
</blockquote>
<h3 id="获取图片"><a href="#获取图片" class="headerlink" title="获取图片"></a>获取图片</h3><pre><code>`File file = new File(Environment.getExternalStorageDirectory(),name);
    if (!file.exists()) return;

    BitmapFactory.Options ops = new BitmapFactory.Options();
    ops.inJustDecodeBounds = true;

    BitmapFactory.decodeFile(file.getAbsolutePath(),ops);
    int imagewidth = ops.outWidth;
    int imageHeight = ops.outHeight;

    Display display = getWindowManager().getDefaultDisplay();
    DisplayMetrics dm = new DisplayMetrics();
    display.getMetrics(dm);
    int screenwidth = dm.widthPixels;
    int screenHeight = dm.heightPixels;

    int scalewidth = imagewidth / screenwidth;
    int scaleheight = imageHeight / screenHeight;

    int scale = scalewidth &gt; scaleheight ? scalewidth : scaleheight;

    ops.inJustDecodeBounds = false;
    ops.inSampleSize = scale;

    Bitmap bm = BitmapFactory.decodeFile(file.getAbsolutePath(),ops);

    imageview.setImageBitmap(bm);`
</code></pre><h3 id="在图片上写文字"><a href="#在图片上写文字" class="headerlink" title="在图片上写文字"></a>在图片上写文字</h3><pre><code>`Bitmap new_bitmap = Bitmap.createBitmap(bm.getWidth(),bm.getHeight(), Bitmap.Config.ARGB_8888);

    Canvas canvas = new Canvas(new_bitmap);
    canvas.drawBitmap(bm,0,0,null);
    Paint paint = new Paint();
    paint.setXfermode(new PorterDuffXfermode(PorterDuff.Mode.DARKEN));
    paint.setTextSize(50);
    paint.setColor(Color.RED);
    canvas.drawText(&quot;徐军波&quot;,100,100,paint);
    imageview.setImageBitmap(new_bitmap);`
</code></pre><h3 id="在图片上添加水印"><a href="#在图片上添加水印" class="headerlink" title="在图片上添加水印"></a>在图片上添加水印</h3><pre><code>`Bitmap new_bitmap = Bitmap.createBitmap(bm.getWidth(),bm.getHeight(), Bitmap.Config.ARGB_8888);
    Bitmap logo = BitmapFactory.decodeResource(getResources(),R.mipmap.ic_launcher);

    Canvas canvas = new Canvas(new_bitmap);
    canvas.drawBitmap(bm,0,0,null);
    Paint paint = new Paint();
    paint.setXfermode(new PorterDuffXfermode(PorterDuff.Mode.DARKEN));
    canvas.drawBitmap(logo,500,500,paint);
    imageview.setImageBitmap(new_bitmap);`
</code></pre><h3 id="Canvas介绍"><a href="#Canvas介绍" class="headerlink" title="Canvas介绍"></a>Canvas介绍</h3><pre><code>1 Canvas drawCircle() 绘制圆形

2 Canvas drawArc() 绘制弧形

3 Canvas drawLine() 绘制线

4 Canvas drawRect() 绘制矩形

5 Canvas drawPath() 绘制自定义路径

6 Canvas drawRoundRect() 绘制圆角矩形
</code></pre>
          
        
      
    </div>
    
    
    
	
	<div>
		
	</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-Android" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/19/7_大图的加载/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JunBoXu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LgStars">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/19/7_大图的加载/" itemprop="url">大图的加载</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-19T19:05:00+08:00">
                2018-03-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/19/7_大图的加载/" class="leancloud_visitors" data-flag-title="大图的加载">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
				 <span>°C</span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="大图的加载"><a href="#大图的加载" class="headerlink" title="大图的加载"></a>大图的加载</h2><blockquote>
<p>现在的android手机内存很大，但是单独一个应用程序只能使用很少的一部分，具体大小和手机有关。</p>
</blockquote>
<blockquote>
<p>在加载图片时，需要的内存空间不是按图片的大小来算的，而是按像素点的多小来计算的。</p>
</blockquote>
<blockquote>
<p>当一个图片加载手机当中去时，需要把每个像素点都加载到内存中。所以对内存的要求很高。一不小心就会造成OOM（Out Of MemoryError）内存溢出的致命错误。</p>
</blockquote>
<h3 id="1-原理"><a href="#1-原理" class="headerlink" title="1 原理"></a>1 原理</h3><pre><code>1 当前有一张图片，大小仅为1M，但是其规格为3648*2736，现在需要加载此图片的总像素点 = 

3648*2736 = 9980928；

2 常用的位图压缩方式：

    - ARGB_8888：4byte
    - RGB_565 : 2byte
    - ARGB_4444 : 2byte

3 假设现在采用ARGB_4444方式，图片占用空间 = 总像素点 * 像素单位 = 9980928 * 2byte = 19961856byte = 19MB.(这就会造成内存溢出)
</code></pre><h3 id="2-实现大图的缩放加载"><a href="#2-实现大图的缩放加载" class="headerlink" title="2 实现大图的缩放加载"></a>2 实现大图的缩放加载</h3><pre><code>`private void loadImage() {
    //找到文件地址
    File file = new File(Environment.getExternalStorageDirectory(),name);
    //定义bitmap
    if (!file.exists()) return;
    BitmapFactory.Options ops = new BitmapFactory.Options();

    ops.inJustDecodeBounds = true;
    BitmapFactory.decodeFile(file.getAbsolutePath(),ops);

    int imageWidth = ops.outWidth;
    int imageHeight = ops.outHeight;

    Display display = getWindowManager().getDefaultDisplay();
    DisplayMetrics displayMetrics = new DisplayMetrics();
    display.getMetrics(displayMetrics);
    int scresswidth = displayMetrics.widthPixels;
    int scressHeight = displayMetrics.heightPixels;

    int widthscale = imageWidth / scresswidth;
    int heightscale = imageHeight / scressHeight;
    int scale = widthscale &gt; heightscale ? widthscale : heightscale;

    ops.inJustDecodeBounds = false;
    ops.inSampleSize = scale;

    Bitmap bp = BitmapFactory.decodeFile(file.getAbsolutePath(),ops);
    imageview.setImageBitmap(bp);
}`
</code></pre>
          
        
      
    </div>
    
    
    
	
	<div>
		
	</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/me.png"
                alt="JunBoXu" />
            
              <p class="site-author-name" itemprop="name">JunBoXu</p>
              <p class="site-description motion-element" itemprop="description">时间就像海绵里的水，只要愿挤，总还是有的。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/LGStars" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:3398334198@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        ﻿<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JunBoXu</span>

  
</div>

<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_pv"></span>
</span>
</div>

<!-- 
  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>
  -->



<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("SkmdmHS8m1n0yBfk0jX7cWzC-gzGzoHsz", "LgApVDF1nFNibYvaiOFMllmk");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

  
  
</body>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
</html>
